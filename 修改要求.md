第二阶段：数据“看门狗” —— 成绩修改审计（Trigger）
目标：老师在《各位同学》文档中特别提到了“安全性”。成绩是学生管理系统中最敏感的数据，绝不能被随意篡改。如果有人改了分数，必须自动记录“原分数”、“新分数”和“修改时间”。

亮点：这个功能完全由数据库自动完成，后端 Go 代码完全不需要写任何额外的日志逻辑。这在答辩时是一个非常好的“解耦”案例。

1. SQL 实现 (添加到 init.sql)
首先，建立一个审计日志表，然后挂载一个触发器。

SQL

-- 1. 创建成绩修改审计表
CREATE TABLE IF NOT EXISTS grade_audit_logs (
    id INT AUTO_INCREMENT PRIMARY KEY,
    grade_id INT NOT NULL COMMENT '被修改的成绩记录ID',
    old_score DECIMAL(5, 2) COMMENT '修改前分数',
    new_score DECIMAL(5, 2) COMMENT '修改后分数',
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '修改时间',
    FOREIGN KEY (grade_id) REFERENCES grades(id) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

-- 2. 创建触发器 (Trigger)
-- 动作：在更新 grades 表之前 (BEFORE UPDATE)，自动记录旧值
DELIMITER //

CREATE TRIGGER trg_audit_grade_update
BEFORE UPDATE ON grades
FOR EACH ROW
BEGIN
    -- 只有当分数确实发生变化时才记录
    IF OLD.score != NEW.score THEN
        INSERT INTO grade_audit_logs (grade_id, old_score, new_score, updated_at)
        VALUES (OLD.id, OLD.score, NEW.score, NOW());
    END IF;
END //

DELIMITER ;